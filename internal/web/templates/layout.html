<!DOCTYPE html>
<html lang="en" data-theme="claudeops">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Claude Ops{{if eq .Page "sessions.html"}} &mdash; Sessions{{else if eq .Page "session.html"}} &mdash; Session{{else if eq .Page "events.html"}} &mdash; Events{{else if eq .Page "memories.html"}} &mdash; Memories{{else if eq .Page "cooldowns.html"}} &mdash; Cooldowns{{else if eq .Page "config.html"}} &mdash; Config{{end}}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.23/dist/full.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script src="https://unpkg.com/htmx-ext-sse@2.2.2/sse.js"></script>
</head>
<body class="bg-surface text-charcoal h-screen overflow-hidden font-sans">
    <div class="flex h-screen">
        {{/* Sidebar navigation */}}
        <nav class="w-56 bg-white border-r border-border flex flex-col shrink-0 h-screen sticky top-0">
            <div class="px-5 py-5 border-b border-border">
                <a href="/" class="flex items-center gap-3">
                    <img src="/static/logo.svg" alt="Claude Ops" class="w-8 h-8" style="image-rendering: pixelated;">
                    <span class="brand-text">CLAUDE OPS</span>
                </a>
            </div>
            <ul class="flex-1 py-3">
                <li>
                    <a href="/"
                       class="nav-link{{if eq .Page "index.html"}} nav-active{{end}}"
                       hx-get="/" hx-target="#main" hx-push-url="true">
                        <span class="nav-icon">&#9632;</span>
                        Overview
                    </a>
                </li>
                <li>
                    <a href="/sessions"
                       class="nav-link{{if or (eq .Page "sessions.html") (eq .Page "session.html")}} nav-active{{end}}"
                       hx-get="/sessions" hx-target="#main" hx-push-url="true">
                        <span class="nav-icon">&#9654;</span>
                        Sessions
                    </a>
                </li>
                <li>
                    <a href="/events"
                       class="nav-link{{if eq .Page "events.html"}} nav-active{{end}}"
                       hx-get="/events" hx-target="#main" hx-push-url="true">
                        <span class="nav-icon">&#9733;</span>
                        Events
                    </a>
                </li>
                <li>
                    <a href="/memories"
                       class="nav-link{{if eq .Page "memories.html"}} nav-active{{end}}"
                       hx-get="/memories" hx-target="#main" hx-push-url="true">
                        <span class="nav-icon">&#9679;</span>
                        Memories
                    </a>
                </li>
                <li>
                    <a href="/cooldowns"
                       class="nav-link{{if eq .Page "cooldowns.html"}} nav-active{{end}}"
                       hx-get="/cooldowns" hx-target="#main" hx-push-url="true">
                        <span class="nav-icon">&#9201;</span>
                        Cooldowns
                    </a>
                </li>
                <li>
                    <a href="/config"
                       class="nav-link{{if eq .Page "config.html"}} nav-active{{end}}"
                       hx-get="/config" hx-target="#main" hx-push-url="true">
                        <span class="nav-icon">&#9881;</span>
                        Config
                    </a>
                </li>
            </ul>
            <div class="px-5 py-3 border-t border-border">
                <button onclick="document.getElementById('run-modal').showModal()"
                        class="run-now-btn w-full">
                    <span class="run-now-icon">&#9654;</span>
                    Run Now
                </button>
            </div>
            <div class="px-5 py-3 border-t border-border">
                <a href="https://github.com/joestump/claude-ops" target="_blank" rel="noopener"
                   class="flex items-center justify-center gap-2 text-xs text-muted hover:text-accent transition-colors font-mono">
                    <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    v0.1.0
                </a>
            </div>
        </nav>

        {{/* Main content area */}}
        <main id="main" class="flex-1 p-8 overflow-y-auto">
            {{.Content}}
        </main>
    </div>
    {{/* Run Now modal */}}
    <dialog id="run-modal" class="run-modal">
        <div class="run-modal-box">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Run Now</h3>
                <button onclick="document.getElementById('run-modal').close()"
                        class="text-muted hover:text-charcoal text-xl leading-none">&times;</button>
            </div>
            <form id="run-form" hx-post="/sessions/trigger" hx-target="#main">
                <label class="block text-sm text-muted mb-2">What should Claude look at?</label>
                <textarea name="prompt" rows="4" id="run-prompt"
                    class="input-field w-full text-sm mb-4"
                    placeholder="e.g. Jellyfin is down. Can you take a look?"></textarea>
                <div class="flex items-center justify-between">
                    <button type="button" onclick="document.getElementById('run-modal').close()"
                            class="text-sm text-muted hover:text-charcoal">Cancel</button>
                    <button type="submit" class="btn-primary" id="run-submit">
                        <span id="run-submit-label">Run</span>
                        <span id="run-submit-spinner" class="hidden ml-2">...</span>
                    </button>
                </div>
            </form>
        </div>
    </dialog>
    <script>
    (function() {
        var modal = document.getElementById('run-modal');
        var form = document.getElementById('run-form');
        var prompt = document.getElementById('run-prompt');
        var submitBtn = document.getElementById('run-submit');
        var submitLabel = document.getElementById('run-submit-label');
        var spinner = document.getElementById('run-submit-spinner');

        // Focus textarea when modal opens.
        modal.addEventListener('click', function(e) {
            if (e.target === modal) modal.close();
        });
        var origShow = modal.showModal.bind(modal);
        modal.showModal = function() {
            origShow();
            prompt.value = '';
            submitBtn.disabled = false;
            submitLabel.textContent = 'Run';
            spinner.classList.add('hidden');
            setTimeout(function() { prompt.focus(); }, 50);
        };

        // Show loading state on submit.
        form.addEventListener('htmx:beforeRequest', function() {
            submitBtn.disabled = true;
            submitLabel.textContent = 'Starting';
            spinner.classList.remove('hidden');
        });

        // Close modal on successful redirect.
        form.addEventListener('htmx:beforeSwap', function(e) {
            modal.close();
        });

        // Handle errors (409 conflict, etc).
        form.addEventListener('htmx:responseError', function(e) {
            submitBtn.disabled = false;
            submitLabel.textContent = 'Run';
            spinner.classList.add('hidden');
            alert(e.detail.xhr.responseText || 'Session already running');
        });
    })();

    // Update active nav link on HTMX navigation.
    document.body.addEventListener('htmx:pushedIntoHistory', function() {
        var path = window.location.pathname;
        document.querySelectorAll('nav .nav-link').forEach(function(link) {
            var href = link.getAttribute('href');
            var isActive = (href === path) || (href === '/' && path === '/');
            link.classList.toggle('nav-active', isActive);
        });
    });
    </script>
</body>
</html>
